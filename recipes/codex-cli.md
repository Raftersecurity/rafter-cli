# Codex CLI Setup

Rafter integrates with OpenAI Codex CLI through **skills** for scanning and auditing, plus a **policy export** for command-level guardrails.

## Automatic setup

```sh
rafter agent init
```

This auto-detects `~/.codex` and installs skills. Done.

## Manual setup

### 1. Generate Codex policy from `.rafter.yml`

If you have a `.rafter.yml` policy file, export it as Codex-compatible TOML:

```sh
rafter policy export --format codex
```

Output:

```toml
# Rafter security policy for OpenAI Codex
# Generated by: rafter policy export --format codex

[rules.blocked]
patterns = [
    "rm -rf /",
    "mkfs\\.",
]

[rules.prompt]
patterns = [
    "npm publish",
    "git push --force",
]
```

Add the output to your Codex configuration.

### 2. Skills (installed by `rafter agent init`)

Two skills are installed to `~/.agents/skills/`:

| Skill | Trigger | Purpose |
|-------|---------|---------|
| `rafter/` | Auto-invoked | Backend security audits (read-only API calls) |
| `rafter-agent-security/` | User-invoked | Local secret scanning, command validation, skill auditing |

### 3. MCP server (alternative)

```json
{
  "mcpServers": {
    "rafter": {
      "command": "rafter",
      "args": ["mcp", "serve"]
    }
  }
}
```

Provides `scan_secrets`, `evaluate_command`, `read_audit_log`, and `get_config` tools.

## Verify

```sh
rafter agent verify
```

Confirms skills are installed and Codex is detected.
